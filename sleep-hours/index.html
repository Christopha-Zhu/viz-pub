<!DOCTYPE html>
<style>

path, line {
  fill: none;
}

</style>
<body>
<svg id="mainimg" width=600 height=600></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script>

function xpos(time, radius = 1) {
  return radius * Math.sin(2 * Math.PI * (time % 24)/24);
}

function ypos(time, radius = 1) {
  return -radius * Math.cos(2 * Math.PI * (time % 24)/24); 
}

var scale_color = d3.scaleLinear()
  .range([0.2, 1]);

var scale_linewidth = d3.scaleLinear()
  .range([0.003, 0.01]);

var svg = d3.select("#mainimg")
    .attr("viewBox", "-1.3, -1.3, 2.6, 2.6")
    .append("g");



d3.csv("data.csv", function(error, data) {
  if (error) throw error;

  data.forEach(function(d, i) {
    d.start = +d.start;
    d.end = +d.end;
    d.n = +d.n;
  });

  console.log(data);

  scale_color.domain([0, d3.max(data, function(d) { return d.n; })]);
  scale_linewidth.domain([0, d3.max(data, function(d) { return d.n; })]);


  svg.selectAll("dot")
    .data(d3.map(data, function(d) { return d.start; }).keys())
    .enter()
    .append("circle")
      .attr("r", 0.07)
      .attr("cx", function(d) { return xpos(d); })
      .attr("cy", function(d) { return ypos(d); })
      .attr("fill", "#fff")
      .on("mouseover", function(d) {
        svg.selectAll("path")
          .attr("stroke-opacity", function(dpath) { return dpath.start == d || dpath.end == d ? 1 : 0; });
      })
      .on("mouseout", function() {
        svg.selectAll("path")
          .attr("stroke-opacity", 1);
      });
  

  svg.selectAll("path")
    .data(data)
    .enter()
    .filter(function(d) {return d.n > 0.03; })
    .append("path")
      .attr("d", function(d) { return "M " + xpos(d.start) + " "  + ypos(d.start) + " " +
                                      "Q 0 0 " + xpos(d.end) + " " + ypos(d.end); })
      .attr("stroke", function(d) { return d3.interpolateYlGnBu(scale_color(d.n)); } )
      .attr("stroke-width", function(d) {return scale_linewidth(d.n); })
      .style("pointer-events", "none");



  
});


</script>
